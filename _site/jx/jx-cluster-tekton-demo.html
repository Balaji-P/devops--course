<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Hands-On Time | vfarcic.github.io</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Hands-On Time" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/jx/jx-cluster-tekton-demo.html" />
<meta property="og:url" content="http://localhost:4000/jx/jx-cluster-tekton-demo.html" />
<meta property="og:site_name" content="vfarcic.github.io" />
<script type="application/ld+json">
{"url":"http://localhost:4000/jx/jx-cluster-tekton-demo.html","@type":"WebPage","headline":"Hands-On Time","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=d7b0fccce7a840960ab2c608e690e524c171b2d9">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">vfarcic.github.io</a></h1>
      

      <h2 id="hands-on-time">Hands-On Time</h2>

<hr />

<h3 id="creating-a">Creating A</h3>
<h1 id="jenkins-x">Jenkins-X</h1>
<h2 id="cluster">Cluster</h2>

<h2 id="prerequisites">Prerequisites</h2>

<hr />

<ul>
  <li><a href="https://git-scm.com/">Git</a></li>
  <li>GitBash (if using Windows)</li>
  <li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a></li>
  <li><a href="https://helm.sh/">Helm</a></li>
  <li>If Google: <a href="https://cloud.google.com/sdk/docs/quickstarts">gcloud CLI</a> and GCP admin permissions</li>
  <li>If Azure: <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli">Azure CLI</a> and Azure admin permissions</li>
  <li>If AWS: <a href="https://aws.amazon.com/cli/">AWS CLI</a> and AWS admin permissions</li>
</ul>

<h2 id="creating-a-cluster-with-jx">Creating A Cluster With jx</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">NAMESPACE</span><span class="o">=</span><span class="nb">cd

echo</span> <span class="s2">"nexus:
  enabled: false
"</span> | tee myvalues.yaml
</code></pre></div></div>

<h2 id="creating-a-cluster-with-jx-gke">Creating A Cluster With jx (GKE)</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>open <span class="s2">"https://console.cloud.google.com/cloud-resource-manager"</span>

<span class="nv">PROJECT</span><span class="o">=[</span>...] <span class="c"># e.g. devops26</span>

<span class="c"># Use default answers</span>

jx create cluster gke <span class="nt">-n</span> jx-rocks <span class="nt">-p</span> <span class="nv">$PROJECT</span> <span class="nt">-r</span> us-east1 <span class="se">\</span>
    <span class="nt">-m</span> n1-standard-2 <span class="nt">--min-num-nodes</span> 1 <span class="nt">--max-num-nodes</span> 2 <span class="se">\</span>
    <span class="nt">--default-admin-password</span><span class="o">=</span>admin <span class="se">\</span>
    <span class="nt">--default-environment-prefix</span> jx-rocks <span class="nt">--git-provider-kind</span> github <span class="se">\</span>
    <span class="nt">--namespace</span> <span class="nv">$NAMESPACE</span> <span class="nt">--prow</span> <span class="nt">--tekton</span>
</code></pre></div></div>

<h2 id="creating-a-cluster-with-jx-aks">Creating A Cluster With jx (AKS)</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Use default answers</span>

jx create cluster aks <span class="nt">-c</span> jxrocks <span class="nt">-n</span> jxrocks-group <span class="nt">-l</span> eastus <span class="se">\</span>
    <span class="nt">-s</span> Standard_B2s <span class="nt">--nodes</span> 3 <span class="nt">--default-admin-password</span><span class="o">=</span>admin <span class="se">\</span>
    <span class="nt">--default-environment-prefix</span> jx-rocks <span class="nt">--git-provider-kind</span> github <span class="se">\</span>
    <span class="nt">--namespace</span> <span class="nv">$NAMESPACE</span> <span class="nt">--prow</span> <span class="nt">--tekton</span>
</code></pre></div></div>

<h2 id="creating-a-cluster-with-jx-eks">Creating A Cluster With jx (EKS)</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=[</span>...] <span class="c"># Replace [...] with the AWS Access Key ID</span>

<span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=[</span>...] <span class="c"># Replace [...] with the AWS Secret Access Key</span>

<span class="nb">export </span><span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span>us-west-2

<span class="c"># Use default answers except in the case specified below.</span>
<span class="c"># Answer with `n` to `Would you like to register a wildcard DNS ALIAS to point at this ELB address?`</span>

jx create cluster eks <span class="nt">-n</span> jx-rocks <span class="nt">-r</span> <span class="nv">$AWS_DEFAULT_REGION</span> <span class="se">\</span>
    <span class="nt">--node-type</span> t2.medium <span class="nt">--nodes</span> 3 <span class="nt">--nodes-min</span> 3 <span class="nt">--nodes-max</span> 6 <span class="se">\</span>
    <span class="nt">--default-admin-password</span><span class="o">=</span>admin <span class="se">\</span>
    <span class="nt">--default-environment-prefix</span> jx-rocks <span class="nt">--git-provider-kind</span> github <span class="se">\</span>
    <span class="nt">--namespace</span> <span class="nv">$NAMESPACE</span> <span class="nt">--prow</span> <span class="nt">--tekton</span>
</code></pre></div></div>

<!--
doctl auth init

export KUBECONFIG=$PWD/workshop_config.yaml

NODES=3

doctl k8s cluster create jx-rocks --count $NODES --region nyc1 --size s-4vcpu-8gb

kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/1cd17cd12c98563407ad03812aebac46ca4442f2/deploy/mandatory.yaml

kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/1cd17cd12c98563407ad03812aebac46ca4442f2/deploy/provider/cloud-generic.yaml

rm -rf charts/metrics-server charts/k8s/metrics-server

mkdir -p charts/k8s

helm fetch stable/metrics-server -d charts --untar

helm template charts/metrics-server --name metrics-server --output-dir charts/k8s --namespace kube-system

kubectl -n kube-system apply -f charts/k8s/metrics-server/templates

# TODO: Fix the metrics server so that `kubectl top nodes` works

# Fetch k8s config from DO UI and replace the one below.
-->
<h2 id="using-the-workshop-cluster-not-today">Using The Workshop Cluster (Not Today)</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKekNDQWcrZ0F3SUJBZ0lDQm5Vd0RRWUpLb1pJaHZjTkFRRUxCUUF3TXpFVk1CTUdBMVVFQ2hNTVJHbG4KYVhSaGJFOWpaV0Z1TVJvd0dBWURWUVFERXhGck9ITmhZWE1nUTJ4MWMzUmxjaUJEUVRBZUZ3MHhPVEExTWpneApORE13TXpWYUZ3MHpPVEExTWpneE5ETXdNelZhTURNeEZUQVRCZ05WQkFvVERFUnBaMmwwWVd4UFkyVmhiakVhCk1CZ0dBMVVFQXhNUmF6aHpZV0Z6SUVOc2RYTjBaWElnUTBFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUIKRHdBd2dnRUtBb0lCQVFDNmhZcVRJYzJBaG5rZkZhTGF6bE8ya2hEc010WW8vZjMvNkxIVExjaE1VK2JoVEJBUApjeDBQNTQ2S1VZK3dNSVdMK0pTT0ZBampBa3BzalkybXVmMGFNZThteEFtUzExWWRoM29hQmJOZFEvckxoUUdGCkJPWjNHYkp6UVBDci92eVlZY0dIMStqREJVOTJ6aE1ITGRBb1BSVnNDUjZVY0RDYlB6bzZUREQrWElUQ3BtemUKamVzRUNsWnpkU2w5clJtNitPUUlBNk9TTlBaRWJuQjdKZnNOVTcxK0hyM3R5djc1aUVRRlptN2xXcnp1a1VsSgo4SG1laGE4WjRkdjNpQzNrYjNQQml3WitJL1VxdDRpcU81eWRsamZQbHdvT1FkV3pYdDlnUU50bzR4MmVwTm1qCldvcVBpaWFIWmtJK3lDMi9BeVdzWkJQUGFwU290VWlEL3pSZEFnTUJBQUdqUlRCRE1BNEdBMVVkRHdFQi93UUUKQXdJQmhqQVNCZ05WSFJNQkFmOEVDREFHQVFIL0FnRUFNQjBHQTFVZERnUVdCQlNlM205MTRoUmlxOXV1eXdiYgpVNElKRi9TWnB6QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFsUnhwMjQ3TUNQUUJCSTRXem05NXlhT3RsQVBjCmtBK0NhVDdDNVFOOURaSEtjY1F5c1VrUjJHNGM2bHd0ckNtVHJFbC9OaW9JcmVWN1huR05CTUV3eVBWLzhLSFMKVStrNGxKSmgxUUlXWFJyMnhTQlZPbW5EemdFNFNLWWtxYndQVGNwanVtMU5wUldSYU1kb2NFWE5FMUk2U1QyUwpSelhhVUF0WHFDRUxCbVZSNm1aV3VOUVVhWGQ5UFhXT3Y0cTE5T0FhRGYxbFJFck5IWkdiQ3dUV1dtaTltWnIvCkdXM2VBRTh4UEE4Vlo2QkdMTU8yMjhkUXAwVmt1TDkreWpoVFZ5bjkweit2K3hqdWI4ajZmUm81WXpMSlN3aXEKbW5NTHpEOGxYcEFVZzQ2L1VCK2l1MG9hODM2L1R6L3JCdDIwejF0Wk9mbU8zZWp4TU5qSmEzL0VWUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://abca04dc-61dc-42d0-a08b-e17f0646e187.k8s.ondigitalocean.com
  name: do-nyc1-jx-rocks
contexts:
- context:
    cluster: do-nyc1-jx-rocks
    user: do-nyc1-jx-rocks-admin
  name: do-nyc1-jx-rocks
current-context: do-nyc1-jx-rocks
kind: Config
preferences: {}
users:
- name: do-nyc1-jx-rocks-admin
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURyVENDQXBXZ0F3SUJBZ0lDQm5Vd0RRWUpLb1pJaHZjTkFRRUxCUUF3TXpFVk1CTUdBMVVFQ2hNTVJHbG4KYVhSaGJFOWpaV0Z1TVJvd0dBWURWUVFERXhGck9ITmhZWE1nUTJ4MWMzUmxjaUJEUVRBZUZ3MHhPVEExTWpneApORE01TURaYUZ3MHhPVEEyTURReE5ETTVNRFphTUg4eEN6QUpCZ05WQkFZVEFsVlRNUXN3Q1FZRFZRUUlFd0pPCldURVJNQThHQTFVRUJ4TUlUbVYzSUZsdmNtc3hIVEFiQmdOVkJBb1RGR3M0YzJGaGN6cGhkWFJvWlc1MGFXTmgKZEdWa01URXdMd1lEVlFRREV5Z3hNVFpoTTJJMU1qQXhOekZtTW1VeFlqZGtNMlJsTWpoaVkySTFPRE5sTm1NMwpNakk0WmpReE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBbm9IWklLRCtSWU1MCjhoQ2d1bFBrM01vcHVMUzVmc2pEWWZLcjNNcjY0ZVBWRXE3ay9mVWRyWU9hMnVnZ1RtdUtnaFRmV2hMOUdtcnIKVXR2UnZUZ0JUN0dmb3UrTW5rYm5RQVhrd2tiWlJRWHBQVnppRlBqanNFbDRLcnZ3alIrRnhQOVluNnpmREZJaQpEMmdxQUcrME1DekFsUzMyQitNT01iWmJENXRpMU9kWnBudkNWOGgvRjM4emRxb2JKVEhHd1RRV1V4MVZNTk41CmE1eENPYTZjUHVXQlpqNEo2aHBUcW05ZmhYTEJDUnVJZ0s0UlFhUHFRd0phRGJvWTI2ZFVNd1VxZmlYOFYyeXYKUWdDenArYnpoOXpma3FsWStFaVlUQjIxa29ldk5aQ2k1TEhpTVVZbHNWaG9Ba0VZT0dpNjZESWJVSG8vMWlYeQozTHQ3VGl0bk9RSURBUUFCbzM4d2ZUQU9CZ05WSFE4QkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCCkJRVUhBd0lHQ0NzR0FRVUZCd01CTUF3R0ExVWRFd0VCL3dRQ01BQXdIUVlEVlIwT0JCWUVGTTJ0RnNUTy83RysKa2JsWTg1NEFOaHcvdVNEZE1COEdBMVVkSXdRWU1CYUFGSjdlYjNYaUZHS3IyNjdMQnR0VGdna1g5Sm1uTUEwRwpDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ08zQ0lwcmpGQmgzQ1p1UUJhKy9hY0k3U2phcTRXMUhVRXhFKytoR001CjZzRWxURVFnVzcrWGtJekdrY3FLVENGQllSQnFDWUwwYmVhWmhtTHhZZUpuS1o5UXIydUt4aGxhck9HNEYzb20KamhPRG0rRlpZNnZoTWtjVlRVNlBQY0NSTmFTWjh1YVVTWnU2SFlWSlJEQnp1TGVocEVmYUF6K0NYd0M0NGduVgppN2VUQ0sxTmd4NnV5cmhDc1FIVFNoU0w4ejNTemJOaU9CN05ZN2xIL3BsemV5ZzdtNnJScUhmaGtORGR6K0ZWCjgzUGVSRTU0UEwvTmFCME4rVFVweml3SThmOU1rWW9GTUFReG9jVmlzQzlXNmxESUt0VTcwMmRHVE1SM2Nrb2UKcnFiVXFPaHNBNFJRYVpuYXZmLzUyUmVCWE8wVG9PNzJjS1VBMXJEK1FXMzAKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBbm9IWklLRCtSWU1MOGhDZ3VsUGszTW9wdUxTNWZzakRZZktyM01yNjRlUFZFcTdrCi9mVWRyWU9hMnVnZ1RtdUtnaFRmV2hMOUdtcnJVdHZSdlRnQlQ3R2ZvdStNbmtiblFBWGt3a2JaUlFYcFBWemkKRlBqanNFbDRLcnZ3alIrRnhQOVluNnpmREZJaUQyZ3FBRyswTUN6QWxTMzJCK01PTWJaYkQ1dGkxT2RacG52QwpWOGgvRjM4emRxb2JKVEhHd1RRV1V4MVZNTk41YTV4Q09hNmNQdVdCWmo0SjZocFRxbTlmaFhMQkNSdUlnSzRSClFhUHFRd0phRGJvWTI2ZFVNd1VxZmlYOFYyeXZRZ0N6cCtiemg5emZrcWxZK0VpWVRCMjFrb2V2TlpDaTVMSGkKTVVZbHNWaG9Ba0VZT0dpNjZESWJVSG8vMWlYeTNMdDdUaXRuT1FJREFRQUJBb0lCQUZqLzA2aU1mUGtPMGVCRApFZHhOU3MzbC9YTW1scGpucFQwVUF3ZmdPT29wQVBTU215VTFRa3F4QUh3MXBoNGlLQTFPSnZMdWdvc1l5YlVtCmxDZklrSVBzMmhPa3FiSWRZYThESUNVdG5zVXd3bnVmOFptUS9sZDNpUytGZzFYYUEwUlBrN1ZrWFlFUGhPeGQKc21lNFVOWlQ2blpZN2pJVGZWN1FZMlRwL0o1SnZoMGl0bmpHR2IyWE4zME9xN3VVYTBXbDZGb0lZNzVIWWRNTQphODhieEd5elBpcmVrZGZvUmFCeCt3ZGhLbVlON05zTjZNM21rREtOM1Bvc2RvdmgrMDRLbGhNUkRMalFJbUxNCkxOckdQVk5vc2FsY2hkQ2YrUEt1ajFDeSs2Tmt4ZkUrOUY2TFFjUXFPVTNrcXQrZVF2TExNcTJvbVBLUU4yZDAKR3BJV2RPRUNnWUVBMFZtTmN5WFZxZlUvQUFMYUtGWjJUeU5ZT2xQTXp1Y3o5NUQ1cStBQnJURHlLU2FGUzdzVAplbTYzdTN4QU41dUwvWDlLakkxTmFJMXhpQUtPR3ovR2dzN3g1aXROSGU5aTY4aVNmSU5BalhHd2VBd1BsVkx2CjlVQ0dwcFdZYndYUCsxN2IzRXc3K1NvaFdyQlV1L2hQL09NMnQvYi9ObDhWSEc3anJrLzBCTFVDZ1lFQXdkUDEKWk9zS05FTzhFV3JXTjlVSXdLTERIdUdobWhHQU9uSUhpalR5TDZBTU93QlcwNWY5M1EzNHRKSHB2Y3FBclQyUApnOG1XdEVyRFVTSE1zS1kyWkxsVy9BczVtVmJaUUhFTTdycXBOV3NvcDNXVk1UeWxlTXhsb3dJWU1scUZUWUFZCjZNcGVuVmhsS29LbVRJMjZUaXhKbGxvQUhrV21WM1E3bXJGOUR2VUNnWUFmOU4rV3VDdkphZHBZRWhkakdPK3UKWE9MVzVIdmJDWWZ4UG53ZU5HK05GRytpd0hLUWdOb1VVbHBSa0VIdE94MC9jUExjU2FXTFZDd0Vhdjl1UVduNApCY2IvTDVUeUFOekV5VFV6TklYaUVYeXlsb1M2Y3BLV2lXY0Vmc2xxQ1NVYVpmeUJ3RkZYVTRzTDRPYk9XclU3CkVTUUZLUHNFUGJkblE3WVZvYmJLRVFLQmdCeFF3SnFiazRRTEdTQmFRUzBxMi9wNFRKVG9WVmxTa1M3NGxZMWwKS3JRMloxTC9PNi94bGs2Q3lnQm5DSVNIWHNEd0sxVVBVQXJLbVRueS9Cb2FUZnZzNzM0bWphV1BBSEhma2dvVwpEcjRWQjMxZk9ncFZWNzhMN1JVaEt6Ty84WlZlejBUQ3U0dTA3Q0tIcjQramJNSWF5aTFDdkoydmd4dG5pWVdSCnhEazVBb0dBU25MdzB4MUlsRWJXWHNacCs4Z1hMSG1seldob0pWRGI1YXNYU1U5Z2EwK3hXRk8zbElvdU5wUzAKWldWR3FNdithVE1WUmJDYXhkbGRXekdCMEx0Mk5nK0xVN1J4MGxFS0dRT1l5K2RDM2hNNzRZRlNqZEZFWHZ0MwppNGdYTFVmWGV3WFdBbS9uTGc2TmswcXByRnNsOU9heXlQcE80S2J4ckJNSWloUW9maU09Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg=="</span> <span class="se">\</span>
    | tee workshop_config.yaml
</code></pre></div></div>

<h2 id="using-the-workshop-cluster">Using The Workshop Cluster</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">LB_IP</span><span class="o">=</span><span class="k">$(</span>kubectl <span class="nt">-n</span> ingress-nginx get svc <span class="se">\</span>
    <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.items[0].status.loadBalancer.ingress[0].ip}"</span><span class="k">)</span>

<span class="nb">echo</span> <span class="nv">$LB_IP</span>

<span class="c"># Only letters, numbers, dash (`-`) and underscore (`_`) charters</span>
<span class="nv">NAMESPACE</span><span class="o">=[</span>...] <span class="c"># Make it unique</span>

jx install <span class="nt">--provider</span> kubernetes <span class="nt">--external-ip</span> <span class="nv">$LB_IP</span> <span class="se">\</span>
    <span class="nt">--domain</span> <span class="nv">$LB_IP</span>.nip.io <span class="nt">--default-admin-password</span><span class="o">=</span>admin <span class="se">\</span>
    <span class="nt">--ingress-namespace</span> ingress-nginx <span class="se">\</span>
    <span class="nt">--ingress-deployment</span> nginx-ingress-controller <span class="se">\</span>
    <span class="nt">--default-environment-prefix</span> tekton <span class="nt">--git-provider-kind</span> github <span class="se">\</span>
    <span class="nt">--namespace</span> <span class="nv">$NAMESPACE</span> <span class="nt">--prow</span> <span class="nt">--tekton</span>
</code></pre></div></div>

<h2 id="using-the-workshop-cluster-1">Using The Workshop Cluster</h2>

<hr />

<ul>
  <li>Answer to all questions with the default values, except in the case listed below</li>
  <li>Answer with <code class="highlighter-rouge">n</code> to “<code class="highlighter-rouge">Would you like to enable Long Term Storage?</code>”</li>
</ul>

<h2 id="verifying-the-installation">Verifying The Installation</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods
</code></pre></div></div>


      
      <div class="footer border-top border-gray-light mt-5 pt-3 text-right text-gray">
        This site is open source. <a href="https://github.com/vfarcic/vfarcic.github.io/edit/gh-pages/jx/jx-cluster-tekton-demo.md">Improve this page</a>.
      </div>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
