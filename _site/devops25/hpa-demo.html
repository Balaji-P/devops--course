<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Hands-On Time | vfarcic.github.io</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Hands-On Time" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/devops25/hpa-demo.html" />
<meta property="og:url" content="http://localhost:4000/devops25/hpa-demo.html" />
<meta property="og:site_name" content="vfarcic.github.io" />
<script type="application/ld+json">
{"url":"http://localhost:4000/devops25/hpa-demo.html","@type":"WebPage","headline":"Hands-On Time","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=d7b0fccce7a840960ab2c608e690e524c171b2d9">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">vfarcic.github.io</a></h1>
      

      <h2 id="hands-on-time">Hands-On Time</h2>

<hr />

<h1 id="autoscaling-deployments-and-statefulsets-based-on-resource-usage">Autoscaling Deployments and StatefulSets Based On Resource Usage</h1>

<h2 id="observing-metrics-server-data">Observing Metrics Server Data</h2>

<hr />

<blockquote>
  <p>Google and Microsoft already ship Metrics Server as part of their managed Kubernetes clusters (GKE and AKS). There is no need to install it, so please skip the commands that follow.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm install stable/metrics-server <span class="nt">--name</span> metrics-server <span class="se">\</span>
    <span class="nt">--version</span> 2.0.2 <span class="nt">--namespace</span> metrics

kubectl <span class="nt">-n</span> metrics rollout status deployment metrics-server
</code></pre></div></div>

<!-- .slide: data-background="img/hpa-metrics-server-scheduler.png" data-background-size="contain" -->

<h2 id="observing-metrics-server-data-1">Observing Metrics Server Data</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl top nodes

kubectl <span class="nt">-n</span> kube-system top pod

kubectl top pods <span class="nt">--all-namespaces</span>

kubectl top pods <span class="nt">--all-namespaces</span> <span class="nt">--containers</span>
</code></pre></div></div>

<!-- .slide: data-background="img/hpa-metrics-server-kubectl.png" data-background-size="contain" -->

<h2 id="observing-metrics-server-data-2">Observing Metrics Server Data</h2>

<hr />

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get --raw "/apis/metrics.k8s.io/v1beta1" | jq '.'

kubectl get --raw "/apis/metrics.k8s.io/v1beta1/pods" | jq '.'
</code></pre></div></div>

<h2 id="auto-scaling-pods-based-on-resource-utilization">Auto-Scaling Pods Based On Resource Utilization</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>scaling/go-demo-5-no-sidecar-mem.yml

kubectl apply <span class="nt">-f</span> scaling/go-demo-5-no-sidecar-mem.yml <span class="nt">--record</span>

kubectl <span class="nt">-n</span> go-demo-5 rollout status deployment api

kubectl <span class="nt">-n</span> go-demo-5 get pods
</code></pre></div></div>

<!-- .slide: data-background="img/hpa-without.png" data-background-size="contain" -->

<h2 id="auto-scaling-pods-based-on-resource-utilization-1">Auto-Scaling Pods Based On Resource Utilization</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>scaling/go-demo-5-api-hpa.yml

kubectl apply <span class="nt">-f</span> scaling/go-demo-5-api-hpa.yml <span class="nt">--record</span>

kubectl <span class="nt">-n</span> go-demo-5 get hpa

kubectl <span class="nt">-n</span> go-demo-5 describe hpa api

kubectl <span class="nt">-n</span> go-demo-5 get pods
</code></pre></div></div>

<!-- .slide: data-background="img/hpa-no-resources.png" data-background-size="contain" -->

<h2 id="auto-scaling-pods-based-on-resource-utilization-2">Auto-Scaling Pods Based On Resource Utilization</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>scaling/go-demo-5-db-hpa.yml

kubectl apply <span class="nt">-f</span> scaling/go-demo-5-db-hpa.yml <span class="nt">--record</span>

kubectl <span class="nt">-n</span> go-demo-5 get hpa

kubectl <span class="nt">-n</span> go-demo-5 describe hpa db

<span class="nb">cat </span>scaling/go-demo-5-no-hpa.yml

kubectl apply <span class="nt">-f</span> scaling/go-demo-5-no-hpa.yml <span class="nt">--record</span>

kubectl <span class="nt">-n</span> go-demo-5 get hpa

kubectl <span class="nt">-n</span> go-demo-5 get pods
</code></pre></div></div>

<h2 id="auto-scaling-pods-based-on-resource-utilization-3">Auto-Scaling Pods Based On Resource Utilization</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>scaling/go-demo-5-api-hpa-low-mem.yml

kubectl apply <span class="nt">-f</span> scaling/go-demo-5-api-hpa-low-mem.yml <span class="nt">--record</span>

kubectl <span class="nt">-n</span> go-demo-5 get hpa

kubectl <span class="nt">-n</span> go-demo-5 describe hpa api

kubectl <span class="nt">-n</span> go-demo-5 get pods
</code></pre></div></div>

<!-- .slide: data-background="img/hpa-scale-up.png" data-background-size="contain" -->

<h2 id="auto-scaling-pods-based-on-resource-utilization-4">Auto-Scaling Pods Based On Resource Utilization</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> scaling/go-demo-5-api-hpa.yml <span class="nt">--record</span>

kubectl <span class="nt">-n</span> go-demo-5 describe hpa api
</code></pre></div></div>

<h2 id="to-replicas-or-not-to-replicas">To Replicas Or Not To Replicas?</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nt">-n</span> go-demo-5 get pods

<span class="nb">cat </span>scaling/go-demo-5-replicas-10.yml

kubectl apply <span class="nt">-f</span> scaling/go-demo-5-replicas-10.yml

kubectl <span class="nt">-n</span> go-demo-5 get pods

kubectl <span class="nt">-n</span> go-demo-5 get pods

kubectl <span class="nt">-n</span> go-demo-5 describe deployment api

diff scaling/go-demo-5-replicas-10.yml scaling/go-demo-5.yml

kubectl apply <span class="nt">-f</span> scaling/go-demo-5.yml
</code></pre></div></div>

<h2 id="to-replicas-or-not-to-replicas-1">To Replicas Or Not To Replicas?</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="nt">-n</span> go-demo-5 describe deployment api

kubectl delete <span class="nt">-f</span> scaling/go-demo-5.yml

kubectl apply <span class="nt">-f</span> scaling/go-demo-5.yml

kubectl <span class="nt">-n</span> go-demo-5 describe deployment api

kubectl <span class="nt">-n</span> go-demo-5 describe deployment api

kubectl apply <span class="nt">-f</span> scaling/go-demo-5-2-5.yml

kubectl <span class="nt">-n</span> go-demo-5 describe deployment api
</code></pre></div></div>

<h2 id="what-now">What Now?</h2>

<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If NOT GKE or AKS</span>
helm delete metrics-server <span class="nt">--purge</span>

kubectl delete ns go-demo-5
</code></pre></div></div>


      
      <div class="footer border-top border-gray-light mt-5 pt-3 text-right text-gray">
        This site is open source. <a href="https://github.com/vfarcic/vfarcic.github.io/edit/gh-pages/devops25/hpa-demo.md">Improve this page</a>.
      </div>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
